(this.webpackJsonpari_stream_react_2=this.webpackJsonpari_stream_react_2||[]).push([[0],{12:function(e,n,o){},14:function(e,n,o){},15:function(e,n,o){"use strict";o.r(n);var t=o(1),c=o.n(t),i=o(3),a=o.n(i),r=o(4),s=o(5),l=o(7),d=o(6),u=(o(12),o(0)),g={iceServers:[{url:"stun:stun.l.google.com:19302"}]},f=function(e){Object(l.a)(o,e);var n=Object(d.a)(o);function o(e){var t;return Object(r.a)(this,o),(t=n.call(this,e)).getPeerConnection=function(){console.log("getPeerConnection"),t.peerConnection=new RTCPeerConnection(g),t.peerConnection.onaddstream=t.gotRemoteStream,t.peerConnection.onicecandidate=t.gotIceCandidate,t.peerConnection.oniceconnectionstatechange=t.onConnectionStatusChange,t.peerConnection.onsignalingstatechange=function(e){console.log("Signaling change",e)}},t.getMediaStream=function(e){console.log("getMediaStream"),navigator.mediaDevices.getDisplayMedia({audio:!0,video:!0}).then((function(n){t.localStream=n,e(n)})).catch((function(e){console.log("getUserMedia error: ",e)}))},t.joinSession=function(){var e=t.state.input;console.log("joinSession"),null==t.peerConnection&&t.getPeerConnection(),""!==JSON.parse(e.trim()).desc?t.getMediaStream(t.createAnswer):alert("Please enter the offer")},t.createOffer=function(e){console.log("create offer"),t.localVideo.current.srcObject=e,t.peerConnection.addStream(e),t.peerConnection.createOffer(t.onConnection,t.handleError)},t.initiateOffer=function(){console.log("initiateOffer"),null==t.peerConnection&&t.getPeerConnection(),t.getMediaStream(t.createOffer)},t.onConnection=function(e){console.log("Description is "+e.sdp),t.peerConnection.setLocalDescription(e),t.signalData.desc=e,t.handleJoin=function(){t.completeHandshake()}},t.createAnswer=function(e){var n=t.state.input;console.log("create answer");var o=JSON.parse(n.trim());t.localVideo.current.srcObject=e,t.peerConnection.addStream(e),t.peerConnection.setRemoteDescription(new RTCSessionDescription(o.desc),(function(){console.log("Success")}),t.handleError),t.peerConnection.createAnswer(t.sendReply,t.handleError),t.addIceCandidates(o.ice)},t.completeHandshake=function(){var e=t.state.input;console.log("Inside complete handshake");var n=e.trim();(n=JSON.parse(n)).desc?(t.peerConnection.setRemoteDescription(new RTCSessionDescription(n.desc),(function(){console.log("Success")}),t.handleError),t.addIceCandidates(n.ice)):alert("Please enter the answer")},t.sendReply=function(e){console.log("send reply"),t.peerConnection.setLocalDescription(e),t.signalData.desc=e,console.log(JSON.stringify(t.signalData))},t.gotIceCandidate=function(e){console.log("gotIceCandidate"),e.candidate&&(t.signalData.ice.push(e.candidate),t.setState({input:JSON.stringify(t.signalData)}))},t.addIceCandidates=function(e){for(var n in console.log("add ice candidates",e),e)t.peerConnection.addIceCandidate(new RTCIceCandidate(e[n]))},t.handleError=function(e){console.log("Error occured "+e)},t.closeCall=function(){console.log("close call"),t.peerConnection.close(),t.localVideo.current.pause(),t.remoteVideo.current.pause(),t.localStream=null},t.showModal=function(){},t.hideModal=function(){},t.onConnectionStatusChange=function(e){switch(t.peerConnection.iceConnectionState){case"checking":console.log("Connecting to peer...");break;case"connected":console.log("Connection established.");break;case"disconnected":console.log("Disconnected."),t.closeCall();break;case"failed":console.log("Failed.");break;case"closed":console.log("Connection closed."),t.peerConnection=null,t.handleJoin=function(){t.joinSession()};break;default:console.log("sdfsfdsfsdfsdf")}},t.gotRemoteStream=function(e){console.log("Received remote stream"),t.remoteVideo.current.srcObject=e.stream},t.handleCall=function(){t.initiateOffer()},t.handleJoin=function(){t.joinSession()},t.state={input:""},t.signalData={desc:null,ice:[]},t.peerConnection=null,t.localVideo=c.a.createRef(null),t.remoteVideo=c.a.createRef(null),t.localStream=null,t}return Object(s.a)(o,[{key:"render",value:function(){var e=this,n=this.state.input;return Object(u.jsxs)("div",{className:"App",children:[Object(u.jsx)("button",{onClick:this.handleCall,children:"call"}),Object(u.jsx)("button",{onClick:this.handleJoin,children:"join"}),Object(u.jsx)("textarea",{value:n,placeholder:"copy",onChange:function(n){return e.setState({input:n.target.value})}}),Object(u.jsxs)("div",{children:[Object(u.jsx)("span",{children:"local"}),Object(u.jsx)("video",{autoPlay:!0,ref:this.localVideo,width:100,height:100})]}),Object(u.jsxs)("div",{children:[Object(u.jsx)("span",{children:"remote"}),Object(u.jsx)("video",{autoPlay:!0,ref:this.remoteVideo,width:100,height:100})]})]})}}]),o}(t.Component);o(14);a.a.render(Object(u.jsx)(c.a.StrictMode,{children:Object(u.jsx)(f,{})}),document.getElementById("root"))}},[[15,1,2]]]);
//# sourceMappingURL=main.e959511a.chunk.js.map